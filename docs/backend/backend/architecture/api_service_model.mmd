graph TD


%% =============================
%% API Layer (FastAPI Routers)
%% =============================
subgraph API[API Layer]
A1[admin.py]
A2[admin_presets.py]
A3[allocations.py]
A4[forecast.py]
A5[integration.py]
A6[lots.py]
A7[masters.py]
A8[orders_refactored.py]
A9[receipts.py]
A10[warehouse_alloc.py]
end


%% =============================
%% Service Layer (Business Logic)
%% =============================
subgraph Service[Service Layer]
S1[AdminService]
S2[AllocationService]
S3[ForecastMatcher]
S4[LotService]
S5[MasterService]
S6[OrderService]
S7[ReceiptService]
S8[WarehouseAllocationService]
end


%% =============================
%% Model Layer (SQLAlchemy ORM)
%% =============================
subgraph Model[Model Layer]
M1[AdminPreset]
M2[Allocation]
M3[Lot]
M4[LotCurrentStock]
M5[Order]
M6[OrderLine]
M7[Warehouse]
M8[Supplier]
M9[Product]
M10[Customer]
end


%% =============================
%% Dependencies
%% =============================
A3 --> S2
S2 --> M2
S2 --> M3
S2 --> M4
S2 --> M6


A8 --> S6
S6 --> M5
S6 --> M6
S6 --> M9


A6 --> S4
S4 --> M3
S4 --> M4


A7 --> S5
S5 --> M7
S5 --> M8
S5 --> M9
S5 --> M10


A9 --> S7
S7 --> M3
S7 --> M5
S7 --> M6


A10 --> S8
S8 --> M3
A2 --> S1